{% extends "base.html" %} {% load staticfiles %} {% load i18n %} 
{% block content %}
<div class="row">
	<div class="col-md-12">
		<div class="box padding-20">
			<form role="form" method="post"
				action="/gvsigonline/survey/survey_update/{{ survey.id }}/">
				{% csrf_token %}
				<div class="box-header with-border">
					<h3 class="box-title">{% trans "Update survey" %}</h3>
					<div class="box-tools pull-right">
						<button type="submit" class="btn btn-default btn-sm">
							<i class="fa fa-floppy-o margin-r-5"></i> {% trans "Save" %}
						</button>
					</div>
				</div>
				<div class="box-body">

					{% if form.errors %}
					<div id="form-error" style="color: #ff0000;">
						<ul>
							{% for field in form %} 
							{% if field.errors %}
							<li>{{field.label}}. {{ field.errors|striptags }}</li> 
							{% endif %} 
							{% endfor %} 
							{% for field, msg in form.errors.iteritems %}
							<li>{{ msg|striptags }}</li> 
							{% endfor %}
						</ul>
					</div>
					{% endif %}

					<div class="row">
						<div class="col-md-12 form-group">
							<label for="id_name">{% trans "Name" %}</label> {{ form.name }}
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-12 form-group">
							<label for="id_name">{% trans "Title" %}</label> {{ form.title }}
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-12 form-group">
							<label for="id_srs">{% trans "SRS" %}</label> {{ form.srs }}
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-12 form-group">
							<span for="id_definition" style="font-weight:bold">{% trans "Definition" %}<div class="box-tools pull-right">
							<div class="btn btn-add-feature btn-default btn-sm">
								<i class="fa fa-plus margin-r-5"></i> {% trans "add form" %}
							</div>
						</div></span> {{ form.definition }}
						</div>
					</div>
					
					
				</div>
			</form>
		</div>
	</div>
</div>


<!-- Modal -->
<div class="modal fade" id="modal-delete-survey" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title" id="myModalLabel">{% trans "Delete section survey" %}</h4>
			</div>
			<div class="modal-body">
				<p>{% trans "The section survey will be deleted" %}</p>
			</div>
			<div class="modal-footer">
				<button id="button-delete-survey-cancel" type="button" class="btn btn-default" data-dismiss="modal">{% trans "Cancel" %}</button>
				<button id="button-delete-survey-accept" type="button" class="btn btn-default">{% trans "Accept" %}</button>
			</div>
		</div>
	</div>
</div>


{% endblock %} {% block extra-scripts %}
<script type="text/javascript" src="{% static "js/lib/transformation/dynamic-forms.js" %}"></script>
<script>
	$('#menu-manage-plugins').addClass("active");
	$('#submenu-survey').addClass("active");
</script>
<script type="text/javascript">
$().ready(function(){ 
	$(".btn-add-feature").click(function(){
		location.href = '/gvsigonline/survey/survey_section_add/{{ survey.id }}/';
	});
	
	$(".btn-update-feature").click(function(){
		var section_id = $(this).attr("data-value");
		location.href = '/gvsigonline/survey/survey_section_update/'+ section_id +'/';
	});
	
	$(".btn-delete-feature").click(function(){
		var section_id = $(this).attr("data-value");
		$('#modal-delete-survey').modal('show');
		
		$('#button-delete-survey-accept').click( function() {
			$.ajax({
				type: 'POST',
				async: false,
				url: '/gvsigonline/survey/survey_section_delete/' + section_id + '/',
				beforeSend:function(xhr){
				    xhr.setRequestHeader('X-CSRFToken', $.cookie('csrftoken'));
				},
				success	:function(response){
					$('#modal-delete-survey').modal('hide');
					location.reload();
				},
				error: function(){}
			});
		});
	});
});
</script>
{% endblock %}
